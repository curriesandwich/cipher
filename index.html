document.getElementById('cipher-form').addEventListener('submit', function (event) {
    event.preventDefault();
    const plaintext = document.getElementById('plaintext').value;
    const { key, encodedText } = encode(plaintext);
    
    // Limit key length to a specific number of characters, e.g., 100
    const maxKeyLength = 100;
    const displayKey = key.length > maxKeyLength ? key.slice(0, maxKeyLength) + '...' : key;

    document.getElementById('key').textContent = displayKey;
    document.getElementById('encoded').textContent = encodedText;

    // Enable copying functionality
    document.getElementById('copy-key').addEventListener('click', () => {
        navigator.clipboard.writeText(displayKey);
    });
    document.getElementById('copy-encoded').addEventListener('click', () => {
        navigator.clipboard.writeText(encodedText);
    });
});

// Function to encode plaintext
function encode(plaintext) {
    const key = generateKey(plaintext);  // Generate the key
    const encodedText = someEncodingFunction(plaintext, key); // Encode the plaintext using the key

    return { key, encodedText };
}

// Example function to generate a random key based on the plaintext
function generateKey(plaintext) {
    // Example key generation logic (you can modify this according to your cipher logic)
    let key = '';
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    for (let i = 0; i < plaintext.length; i++) {
        key += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    return key;
}

// Placeholder for your encoding function
function someEncodingFunction(plaintext, key) {
    // Example encoding logic (you should implement your actual cipher logic here)
    let encoded = '';
    for (let i = 0; i < plaintext.length; i++) {
        encoded += String.fromCharCode(plaintext.charCodeAt(i) + key.charCodeAt(i % key.length));
    }
    return encoded;
}

// Decode functionality
document.getElementById('decode-form').addEventListener('submit', function (event) {
    event.preventDefault();
    const ciphertext = document.getElementById('ciphertext').value;
    const decodeKey = document.getElementById('decode-key').value;

    const decodedText = decode(ciphertext, decodeKey);
    document.getElementById('decoded-result').textContent = decodedText;
});

// Function to decode ciphertext
function decode(ciphertext, key) {
    // Example decoding logic (implement your actual cipher logic here)
    let decoded = '';
    const parsedKey = JSON.parse(key); // Parse the JSON key if necessary

    for (let i = 0; i < ciphertext.length; i++) {
        decoded += String.fromCharCode(ciphertext.charCodeAt(i) - parsedKey.charCodeAt(i % parsedKey.length));
    }
    return decoded;
}
